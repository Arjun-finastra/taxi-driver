<!DOCTYPE HTML>
<html>
	<!-- InstanceBegin template="/Templates/main.dwt" codeOutsideHTMLIsLocked="false" -->
	<head>
		<title>Mobile App</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" >

		<link href="css/jquerymobile.min.css" type="text/css" rel="stylesheet">
		<link href="css/style.css" type="text/css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css">
		<link href="css/media-query.css" type="text/css" rel="stylesheet">
		<script src="js/jquery.min.js"></script>
		<script src="js/jquerymobile.min.js"></script>
		<script src="js/logger.js"></script>
		<script src="cordova.js"></script>
		<script src="js/functions.js"></script>
		<!-- InstanceBeginEditable name="EditableHead" -->
		
		<script type="text/javascript">
			//localStorage.setItem('driverUserId', '4');
			driver = 4;

			$(document).ready(function() {

				params = {
					callback : 'callbackIsOnduty',
					controller : 'Drivers',
					action : 'isOnduty',
					data : [{
						driverId : driver
					}]
				};

				getAjaxData(params, 'callbackIsOnduty');

				$("body").on('click', "input[type=checkbox][name=onoffswitch]", function() {
					if ($('input[type=checkbox][name=onoffswitch]').is(':checked')) { makeChange = 0; } else { makeChange = 1; }
					params = { callback : 'callbackChangeDuty', controller : 'Drivers', action : 'changeOnduty', data : [{ changeStatus : makeChange, driverId : driver }] };
					getAjaxData(params, 'callbackChangeDuty');
				});
							
				$('#goOffline').click(function(e) {  
					//alert(1);
					params = { callback : 'callbackGoOffline', controller : 'Drivers', action : 'goOffline', data : [{ driverId : driver }] };
					getAjaxData(params, 'callbackGoOffline');
				});
				
				$('#goOnrest').click(function(e) {  
					//alert(1);
					//$(this).css('display','none')
					params = { callback : 'callbackGoOnrest', controller : 'Drivers', action : 'goOnrest', data : [{ driverId : driver }] };
					getAjaxData(params, 'callbackGoOnrest');
				});
				
				$('#goUnrest').click(function(e) {  
					params = { callback : 'callbackGoUnrest', controller : 'Drivers', action : 'goUnrest', data : [{ driverId : driver }] };
					getAjaxData(params, 'callbackGoUnrest');
				});

			});

			function callbackIsOnduty(data) {

				if (data.success == true) {
					$.each(data.data, function(key, value) {

						if(key == 'User') {
							$('#username').append(value.username);				
						}
						if(key == 'Driver') {
							if (value.is_onduty == '0') {
									$('#dutyStatus').append(' is offline');
									$(".onoffswitch").css("display", "block");
									$(".offonState").css("display", "none");
									$('#activeVehicleInfo').css("display", "none");
									window.variable = 8;
								} else if (value.is_onduty == '1') {
									//$('input[type=checkbox][name=onoffswitch]').prop('checked', true); .onoffswitch 
									$(".offonState").css("display", "block");
									$('#dutyStatus').append(' is on duty. '+'<span class="green_circle"></span>'); 
									$('#goOnrest').css("display", "inline");
									$('#goUnrest').css("display", "none");
									window.variable = 9;
								} else if (value.is_onduty == '2') {
								
									
									window.variable = 7;
									
									$('#goUnrest').css("display", "inline");
									$('#goOnrest').css("display", "none");
									$('#dutyStatus').append(' is on rest.'+'<span class="yellow_circle"></span>');
								}
						}						
						
						if(key == 'Vehicle') {
							$.each(value, function(key, value) {
								if(value['DriversVehicle']['is_current'] == 1 /*&& window.variable == 9*/ ){
									$('#activeVehicleInfo').append('Current Vehicle '+value['registration_no']);
									//$('#goOnrest').css("display", "inline");
									//$('#goUnrest').css("display", "none");
									//window.location.reload(true);
								} else if(value['DriversVehicle']['is_current'] == 0 /*&& window.variable == 7*/ ) {
									//$('#activeVehicleInfo').append('Diver is now on rest mood');
									//$('#goUnrest').css("display", "inline");
									//$('#goOnrest').css("display", "none");
									//window.location.reload(true);
								}
								
								//if( value['DriversVehicle']['is_current'] != 1 ) $('#activeVehicleInfo').append('rest mood');
								
							})					
						}
					});
				} else {

				}
			}

			function callbackChangeDuty(data) {

				if (data.success == true) {
					window.location.href = "my-vehicles.html";
				} else {

				}
			}
			
			function callbackGoOffline(data){
				if (data.success == true) {
					window.location.reload();
				} else {

				}
			}
			
			function callbackGoOnrest(data){
				if (data.success == true) {
					window.location.reload();
				} else {

				}
			}
			
			function callbackGoUnrest(data){
				if (data.success == true) {
					window.location.reload();
				} else {

				}
			}
			

		</script>
		<!-- InstanceEndEditable -->
	</head>

	<body>
		<div data-role="page">
			<div id="page">
				<header data-role="none">
					<div id="header-logo">
						<div class="tile-box">
							<a href="dashboard.html" rel="external"><img src="images/taxi-logo.png" alt="Get a Taxi App"></a>
						</div>
					</div>
					<!-- InstanceBeginEditable name="EditableHeader" -->

					<!-- InstanceEndEditable -->
				</header>
				<div data-role="none" id="content">
					<!-- InstanceBeginEditable name="EditableBody" -->
					<div id="information">
						<div id="leftInfo">
							<span id="username"></span><span id="dutyStatus"></span>
							<div id="activeVehicleInfo"></div>
						</div>
						<div id="rightInfo">
							<div class="offonState">
								<div class="btn-off" id="goOffline">Offline</div>
								<div class="btn-rest" id="goOnrest">Rest</div>
								<div class="btn-rest" id="goUnrest">On duty</div>
							</div>

						
							<div class="onoffswitch">
								<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" data-role="none">
								<label class="onoffswitch-label" for="myonoffswitch" data-role="none">
									<div class="onoffswitch-inner">
										<div class="onoffswitch-active"><div class="onoffswitch-switch">Duty</div></div>
										<div class="onoffswitch-inactive"><div class="onoffswitch-switch">Online</div></div>
									</div>
								</label>
							</div>

						</div>
					</div>
					

					<div class="tile mini onduty-bg">

						<div class="tile-box">


						</div>

					</div>

					<div class="tile mini get-quote-bg">

						<div class="tile-box">
						


						</div>

					</div>
					<div class="tile mini my-profile-bg">
						<a href="profile.html" data-transition="slide"></a>
						<div class="tile-box">
							<i class="fa fa-user fa-4x"></i>
							<div>
								My Profile
							</div>
						</div>
					</div>
					<div class="tile mini help-bg">
						<a href="my-jobs.html" data-transition="flip"></a>
						<div class="tile-box">
							<i class="fa fa-briefcase fa-4x"></i>
							<div>
								My Jobs
							</div>
						</div>
					</div>
					<div class="tile mini my-profile-bg">
						<a href="my-invoices.html" data-transition="flip"></a>
						<div class="tile-box">
							<i class="fa fa-check-circle-o fa-4x"></i>
							<div>
								My Invoices
							</div>
						</div>
					</div>

					<div class="tile mini sign-out-bg">
						<a href="logout.html" data-transition="flip"></a>
						<div class="tile-box">
							<i class="fa fa-sign-out fa-4x"></i>
							<div>
								Sign Out
							</div>
						</div>
					</div>

					<!-- InstanceEndEditable -->
					<div style="clear:both"></div>
				</div>
				<footer data-role="footer" data-position="fixed">

					<!-- InstanceBeginEditable name="EditableFooter" -->

					<!-- InstanceEndEditable -->
				</footer>
			</div>
		</div>
	</body>
	<!-- InstanceEnd -->
</html>
