<!DOCTYPE HTML>
<html><!-- InstanceBegin template="/Templates/main.dwt" codeOutsideHTMLIsLocked="false" -->
    <head>
        <title>Mobile App</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<!-- FontAwesome - http://fortawesome.github.io/Font-Awesome/ -->
        <link rel="stylesheet" href="css/font-awesome.min.css" />
		<!-- jQueryMobileCSS - original without styling -->
        <link rel="stylesheet" href="css/jquerymobile.css" />
		<!-- nativeDroid core CSS -->
        <link rel="stylesheet" href="css/jquerymobile.nativedroid.css" />
		<!-- nativeDroid: Light/Dark -->
        <link rel="stylesheet" href="css/jquerymobile.nativedroid.dark.css"  id='jQMnDTheme' />
		<!-- nativeDroid: Color Schemes -->
        <link rel="stylesheet" href="css/jquerymobile.nativedroid.color.green.css" id='jQMnDColor' />
		<!-- jQuery / jQueryMobile Scripts -->
        <link href="css/style.css" type="text/css" rel="stylesheet">
 		<!-- style link -->       
		<script src="js/jquery-1.9.1.min.js"></script>
        <script src="js/jquery.mobile-1.3.1.min.js"></script>
        
		<script src="js/logger.js"></script>
		<script src="cordova.js"></script>
		<script src="js/functions.js"></script>
		<script type="text/javascript">
        	$(document).ready(function() {
         		allowAccess();
             	$(document).on( 'pagecreate','#page', function(event){
              		setUserToken();
             	});
        	});
        </script>
	<!-- InstanceBeginEditable name="EditableHead" -->
	<script charset="utf-8" type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<link href="https://developers.google.com/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
		<!-- InstanceEndEditable --> 
    </head>
    <body>
        
    <div data-role="page" data-theme='b'>
		<header data-role="none">
			<div id="header-logo">
				<div class="tile-box"><a href="dashboard.html" rel="external"><img src="images/taxi-logo.png" alt="Get a Taxi App"></a></div>
			</div>
		<!-- InstanceBeginEditable name="EditableHeader" -->
					<script type="text/javascript">
						currentUser = getLocalStorage("User");
						driver = currentUser.id;
					
						$(document).ready(function() {
							
							params = { callback : 'callbackVehicleList', controller : 'Vehicles', action : 'vehicleList', data : [{ userId : driver }] }; 
							getAjaxData(params, 'callbackVehicleList');
							
							checkedId = $("input[name='vehicleActive']:checked").val();
							$("body").on('click', "input[name='vehicleActive']",function() { 
								valueText = $(this).val(); 	
								params = { callback : 'callbackMakeVehicleCurrent', controller : 'DriversVehicles', action : 'makeVehicleCurrent', data : [{ currentId : valueText, previousId: checkedId }] }; 
								getAjaxData(params, 'callbackMakeVehicleCurrent');  
								
							});
							
							$("#goback").click(function(e) {  
								//alert(1);
								//window.location.href = "dashboard.html";
							});
							
							navigator.geolocation.getCurrentPosition(onSuccess_current, onError);
						
						});
						
						function callbackVehicleList(data) { 
							if (data.success == true) { 
								$.each(data.data, function(key, value) { $.each(data.data[key], function(key, value) { if (key == 'Vehicle') { $('#my-vehicle-list ul').append('<li>' + key + ': ' + value.registration_no + '&#9;&#9;<input type="radio" name="vehicleActive" value="' + value.id + '">Active</li>'); console.log(value.registration_no); } }) }); 
								checkDriversActiveVehicle(); 
							}
						}

						function checkDriversActiveVehicle() { 
							params = { callback : 'callbackActiveVehicle', controller : 'DriversVehicles', action : 'checkVehicleisCurrent', data : [{ userId : driver }] }; 
							getAjaxData(params, 'callbackActiveVehicle'); 
						}

						function callbackActiveVehicle(data) { 
							if(data.success == true){ 
								$.each(data.data, function(key, value) { 
									checkedId = value['DriversVehicle']['id']; 
									console.log(value['DriversVehicle']['id']); 
									$('input:radio[name=vehicleActive][value='+checkedId+']').prop('checked', true);								
								})
							}			
						}						
									
						function callbackMakeVehicleCurrent(data) { 
						
							if(data.success == true) {
								
								//alert("vehicle change success");
								try {
									navigator.geolocation.getCurrentPosition(onSuccess, onError);
								} catch (e){
									alert(e.message);
								}
								window.location.href = "dashboard.html";
							}
						}
					
					function onSuccess(position) {
						alert("update success");
						params = { callback : 'callbackUpdateLocation', controller : 'DriversVehicles', action : 'updateLocation', data : [{ latitude : position.coords.latitude, longitude : position.coords.longitude, driverId : localStorage.getItem("driverid") }] };
						getAjaxData(params, 'callbackUpdateLocation');
						
					}
					
					    function onError(error) {
							alert('code: '    + error.code    + '\n' +
								  'message: ' + error.message + '\n');
						}
					
				
				function callbackUpdateLocation(data) {
					   if(data.success == true) {
					   alert('lets redirect');
						window.location.href = "dashboard.html";
							//alert('updated');
					   }
					}	


						

						



					</script>
					<!-- InstanceEndEditable -->
		</header>
        
        <div id="content"> 
		<!-- InstanceBeginEditable name="EditableBody" -->

					<div class="my-profile-bg content-position">
						<h2>My Vehicle</h2>
						<div id="result"></div>
						Assigned Vehicles are:-      </br></br>
						<div id="my-vehicle-list">
							<form data-role="none">
								<ul>
									<li>
										No vechicle active &#9;&#9;
										<input type="radio" name="vehicleActive" value="inactive" data-role="none"  checked>
										
									</li>
								</ul>
							</form>
						</div>
						

						<div id="goback" data-role="none" style="text-align:center; cursor:pointer; ">Go to Dashboard</div>
						

					</div>

					<!-- InstanceEndEditable -->
		<div style="clear:both"></div>
	</div>
	<footer data-role="footer" data-position="fixed">
		
    <!-- InstanceBeginEditable name="EditableFooter" -->

					<!-- InstanceEndEditable -->
	</footer>
	</div>
	</div>
</body>
<!-- InstanceEnd --></html>
