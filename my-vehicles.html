<!DOCTYPE HTML>
<html><!-- InstanceBegin template="/Templates/main.dwt" codeOutsideHTMLIsLocked="false" -->
    <head>        
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        
        <title>Mobile App</title>        
        
		<link href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" 
        rel="stylesheet" type="text/css"/>
        <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/jquerymobile.css" rel="stylesheet" type="text/css"/>                
		<!-- nativeDroid core CSS -->
        <link href="css/jquerymobile.nativedroid.css" rel="stylesheet" type="text/css"/>
        
		<!-- nativeDroid: Light/Dark -->
        <link href="css/jquerymobile.nativedroid.dark.css" rel="stylesheet" type="text/css" id='jQMnDTheme'/>
        
		<!-- nativeDroid: Color Schemes -->
        <link href="css/jquerymobile.nativedroid.color.green.css" rel="stylesheet" type="text/css" id='jQMnDColor'/>        	
        <link href="css/style.css" rel="stylesheet" type="text/css"/>
         		       
		<script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
        <script src="js/jquery.mobile-1.4.2.min.js" type="text/javascript"></script>        
		<script src="js/logger.js" type="text/javascript"></script>
		<script src="cordova.js" type="text/javascript"></script>
		<script src="js/functions.js" type="text/javascript"></script>
		<script type="text/javascript">
        	$(document).ready(function() {
         		allowAccess();
             	$(document).on( 'pagecreate','#page', function(event){
              		setUserToken();
             	});
        	});
        </script>
	<!-- InstanceBeginEditable name="EditableHead" -->
	<script charset="utf-8" type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<link href="https://developers.google.com/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
		<!-- InstanceEndEditable --> 
    </head>
    
    <body>        
        <div data-role="page" style="">            
            <div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="e" 
            id="header">
                <div class="container">
                	<div class="top-icons ti-left">
                    	<a href="#" data-ajax="false" target="_blank">
                            <i class="icon-android"></i>
                        </a>
                    </div>                	
                    
                    <div id="header-logo">
                        <div class="tile-box text-center">
                            <a href="dashboard.html" rel="external">
                                <img src="images/taxi-logo.png" alt="Get a Taxi App">
                            </a>
                        </div>
                    </div>                                   
                    
                    <div class="top-icons ti-right">
                    	<a href="#">
                            <i class="icon-user"></i>
                        </a>
                        <a href="#">
                            <i class="icon-cogs"></i>
                        </a>                        
                    </div>
                    
                <!-- InstanceBeginEditable name="EditableHeader" -->
					<script type="text/javascript">
						currentUser = getLocalStorage("User");
						driver = currentUser.id;
					
						$(document).ready(function() {							
							params = { 
								callback : 'callbackVehicleList', 
								controller : 'Vehicles', 
								action : 'vehicleList', 
								data : [{ userId : driver }] 
							}; 
							getAjaxData(params, 'callbackVehicleList');
							
							
							$("body").on('click', "label",function() { 
								clickedId = $(this).prev('input[type="radio"]').attr('value');
								checkedId = $(this).parent('form').find('.checkedInput').attr('for');
								//alert(clickedId);
								//console.log(checkedId);
								params = { 
									callback : 'callbackMakeVehicleCurrent', 
									controller : 'DriversVehicles', 
									action : 'makeVehicleCurrent', 
									data : [{ currentId : clickedId, previousId: checkedId }] 
								}; 
								getAjaxData(params, 'callbackMakeVehicleCurrent');  								
							});							
							
							//navigator.geolocation.getCurrentPosition(onSuccess_current, onError);						
						});
						
						function callbackVehicleList(data) { 
							if (data.success == true) { 
								$.each(data.data, function(key, value) { 
									$.each(data.data[key], function(key, value) { 
										if (key == 'Vehicle') { 
											$('#my-vehicle-list form').append('<input type="radio" name="vehicleActive" class="radio" value="' + value.id + '" data-role="none"/><label for="'+value.id+'" style="clear:both;">'+key +':'+value.registration_no+'</label>'); 
										} 
									}) 
								}); 
								checkDriversActiveVehicle(); 
							}
						}

						function checkDriversActiveVehicle() { 
							params = { 
								callback : 'callbackActiveVehicle', 
								controller : 'DriversVehicles', 
								action : 'checkVehicleisCurrent', 
								data : [{ userId : driver }] 
							}; 
							getAjaxData(params, 'callbackActiveVehicle'); 
						}

					function callbackActiveVehicle(data) { 
						if(data.success == true){ 
							$.each(data.data, function(key, value) { 
								checkedId = value['DriversVehicle']['id']; 
								//alert(checkedId);
								$('input:radio[name=vehicleActive][value='+checkedId+']').prop('checked', true);
								$("label").removeClass('checkedInput').addClass('uncheckedInput');
								$("label[for='" + checkedId + "']").removeClass('uncheckedInput').addClass('checkedInput');									
							})
						}			
					}						
									
					function callbackMakeVehicleCurrent(data) { 					
						if(data.success == true) {							
							//alert("vehicle change success");
							try {
								navigator.geolocation.getCurrentPosition(onSuccess, onError);
							} catch (e){
								alert(e.message);
							}
							//window.location.href = "dashboard.html";
						}
					}
					
					function onSuccess(position) {
						alert("update success");
						params = { 
							callback : 'callbackUpdateLocation', 
							controller : 'DriversVehicles', 
							action : 'updateLocation', 
							data : [{ 
								latitude : position.coords.latitude, 
								longitude : position.coords.longitude, 
								driverId : localStorage.getItem("driverid")
							}] 
						};
						getAjaxData(params, 'callbackUpdateLocation');						
					}
					
					function onError(error) {
						alert('code: '    + error.code    + '\n' +
							  'message: ' + error.message + '\n');
					}
									
					function callbackUpdateLocation(data) {
						if(data.success == true) {
							window.location.href = "dashboard.html";
					   }
					}	
					</script>
					<!-- InstanceEndEditable -->
                <div class="clearfix"></div>
                </div>
            </div>               
        
        
            <div id="content"> 
                <div class="container">
                <!-- InstanceBeginEditable name="EditableBody" -->

					<div class="my-profile-bg content-position">
						<h2>My Vehicles</h2>
                        
						<div id="result"></div>
                        
						<h4>Assigned Vehicles are :-</h4>
                        
						<div id="my-vehicle-list">
                            <form data-role="none">																								
                            	<input type="radio" name="vehicleActive" class="radio" 
                                data-role="none" value="inactive" />
                                <label for="radio1" style="clear:both">No vechicle active</label>  
                            </form>
						</div>
												
						<div class="clearfix"></div>
                        
						<div data-role="none" style="text-align:center; cursor:pointer;">
                        	Go to Dashboard
                        </div>
					</div>

					<!-- InstanceEndEditable -->
                </div>
                <div class="clearfix"></div>
            </div>
            
            <div data-position="fixed" data-tap-toggle="false" data-role="footer" 
            data-tap-toggle="false" data-theme="b" id="footer">
                <div class="container">
                    <div data-role="navbar">
                        <ul>
                            <li>
                                <a href="index.html">
                                    <i class="icon-home"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon-picture"></i>
                                </a>
                            </li>
                            <li>
                                <a href="logout.htnl" id="logout">
                                    <i class="icon-signout"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <!-- InstanceBeginEditable name="EditableFooter" -->

					<!-- InstanceEndEditable -->
                </div>
            </div>            
        </div>
	</body>
<!-- InstanceEnd --></html>
